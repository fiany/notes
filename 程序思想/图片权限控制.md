# 关于图片权限控制的思考

## 问题出现

我们所有的web项目都会涉及到图片的内容，之前的项目类似于网上商城，所使用到的图片都是直接使用nginx做转发，指向图片的根路径，而现在的项目中出现了一些隐私性的图片，这些图片就需要做些权限控制了。

## 目前的解决方案

在之前所做的第一个项目中，我们把所有的图片存入了数据库中，前后端传输转为base64编码，因为这个项目不存在外部可以访问的内容，所以这样做看似没有问题，但是这样有一个问题，传送给前端的时候我们只给了图片id，前台需要的时候调接口去下载，如果是一个列表，前台会多次请求下载图片，感觉也是不妥，而且图片都存入数据库，也不方便后续查看，较为复杂，后面的一个项目中，隐私类的图片存入数据库，外部可以查看的图片存入ftp,使用nginx做静态资源转发，但这里有两个图片上传接口，貌似是有点复杂了。

## 一点构想

目前我现在有一个想法，所有的图片统一调用一个图片上传接口，form表单形式提交的图片，图片存入ftp中，然后生成一个图片编码和图片ftp的url,然后生成图片权限控制信息(具体如何控制权限，后面再进行思考)，再生成一个可以下载图片的url返回给前端，再添加一个图片下载接口，这个接口使用get请求，可以携带header信息，通过header信息我们可以判断用户是否有访问权限，如果无权限可以返回一个默认图片，这个get请求的url就是前面提到的返回给前端的url，为什么使用get请求呢，因为这个可以直接嵌入标签中，网页也可以直接访问，而不需要再单独写业务逻辑。感觉这个方案相比之前会有很多提升。